{% extends 'front/base.html.twig' %}

{% use 'bootstrap_4_horizontal_layout.html.twig' %}

{% form_theme form 'form/modelComments.html.twig' %}

{% block meta %}
<meta property="og:locale" content="fr_FR" />
<meta property="og:type" content="article" />
<meta property="og:title" content="{{ model.name }}" />
<meta property="og:description" content="Faites imprimer en 3D le modèle {{ model.name }}.{{ model.caracteristique}}. Et découvrez de nombreux modèles sur United-3d Makers" />
<meta property="og:url" content="{{ path('model_detail', {'id': model.id, 'name': model.name }) }}" />
<meta property="og:site_name" content="Modèle {{ model.name }} à imprimer en 3D" />
<meta property="article:tag" content="modèle 3D" />
<meta property="article:tag" content="{{ model.tags }}" />
<meta property="article:section" content="Modèle 3D" />
<meta property="article:published_time" content="{{ model.createdAt|date('d/m/Y', 'Europe/Paris') }}" />
<meta property="article:modified_time" content="{{ model.updatedAt|date('d/m/Y', 'Europe/Paris') }}" />
<meta property="og:updated_time" content="{{ model.updatedAt|date('d/m/Y', 'Europe/Paris') }}" />
<meta property="og:image" content="{{ images[0] }}" />
<meta property="og:image:secure_url" content="{{ images[0] }}" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="682" />

<meta name="title" content="Modèle {{ model.name }} à imprimer en 3D" />
<meta name="description" content="Faites imprimer en 3D le modèle {{ model.name }}.{{ model.caracteristique}}. Et découvrez de nombreux modèles sur United-3d Makers" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Faites imprimer en 3D le modèle {{ model.name }}.{{ model.caracteristique}}. Et découvrez de nombreux modèles sur United-3d Makers" />
<meta name="twitter:title" content="{{ model.name }}" />
<meta name="twitter:image" content="{{ images[0] }}" />
	<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window,document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '2265820913678030'); 
fbq('track', 'PageView');
</script>
<noscript>
<img height="1" width="1" 
src="https://www.facebook.com/tr?id=2265820913678030&ev=PageView&noscript=1"/>
</noscript>
<!-- End Facebook Pixel Code -->
<link rel='stylesheet' id='easy-facebook-likebox-plugin-styles-css'  href='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/css/public.css?ver=4.3.5' type='text/css' media='all' />
<link rel='stylesheet' id='easy-facebook-likebox-font-awesome-css'  href='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/css/font-awesome.css?ver=4.3.5' type='text/css' media='all' />
<link rel='stylesheet' id='easy-facebook-likebox-animate-css'  href='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/css/animate.css?ver=4.3.5' type='text/css' media='all' />
<link rel='stylesheet' id='easy-facebook-likebox-popup-styles-css'  href='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/popup/magnific-popup.css?ver=4.3.5' type='text/css' media='all' />

<script type='text/javascript' src='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/popup/jquery.magnific-popup.min.js?ver=4.3.5'></script>
<script type='text/javascript' src='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/js/jquery.cookie.js?ver=4.3.5'></script>
<script type='text/javascript' src='{{ www_base_url }}/wp-content/plugins/easy-facebook-likebox/public/assets/js/public.js?ver=4.3.5'></script>
{% endblock %}

{% block body %}
    <div class="container bg-white pad-15-20">
        <div class="row">
            <div class="col-sm-6 ">
                <div class="container col-md-12 col-sm-12  col-xs-12">
                    <div id="myCarousel" class="carousel slide carousel-detail" data-ride="carousel" data-interval="15000">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                            {% for image in images %}
                                {% if loop.index0 == 0 %}
                                    <li data-target="#myCarousel" data-slide-to="{{ loop.index0 }}" class="active"></li>
                                {% else %}
                                    <li data-target="#myCarousel" data-slide-to="{{ loop.index0 }}"></li>
                                {% endif %}
                            {% endfor %}
                        </ol>

                        <!-- Wrapper for slides -->
                        <div class="carousel-inner">
                            {% for image in images %}
                                {% if loop.index0 == 0 %}
                                    <div class="item detail-img active">
                                        <img src="{{ image }}" alt="{{ model.name }}" >
                                    </div>
                                {% else %}
                                    <div class="item detail-img">
                                        <img src="{{ image }}" alt="{{ model.name }}">
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                    <div class="col-xs-4 btnList">
                        {% if model.priceTaxIncl == 0 %}
                            <a href="{{ path('model_download', {'id': model.id, 'name': model.name}) }}">
                                <button type="button" title="Télécharger" class="btn btn-list" align="left" data-target="#">Télécharger <span class="glyphicon glyphicon-download-alt"></button>
                            </a>
                        {% else %}
                        {% if user is defined %}
                            {% if user is null %}
                                <button type="button" title="Ajouter au panier" class="btn btn-list" align="left" data-toggle="modal" data-target="#myModal">Acheter <span class="glyphicon glyphicon-shopping-cart"></button>
                            {% else %}
                                <button type="button" title="Ajouter au panier" class="btn btn-list" align="left" id="addCart">Acheter <span class="glyphicon glyphicon-shopping-cart"></button>
                            {% endif %}
                        {% endif %}

                           
                        {% endif %}
                    </div>
                    <div class="col-xs-8 btnList" align="right">
                        {% if 1 > allreadyLove|length %}
                            <a href="{{ path('model_love', {'id': model.id, 'name': model.name}) }}">
                                <button type="button" class="btn btn-list infosbull infosbull-2" data-target="#">
                                    {{ model.love}} <span class="glyphicon glyphicon-heart"></span>
                                    <p>
                                        Nombre de j'aime
                                    </p>
                                </button>
                            </a>
                        {% else %}
                            <a href="{{ path('model_dislove', {'id': model.id, 'name': model.name}) }}">
                                <button type="button" class="btn btn-list infosbull infosbull-2 allReady-Love" data-target="#">
                                    {{ model.love}} <span class="glyphicon glyphicon-heart"></span>
                                    <p>
                                        Nombre de j'aime
                                    </p>
                                </button>
                            </a>
                        {% endif %}
                        
                        <a href="#commentsAnchor">
                            <button type="button" class="btn btn-list infosbull infosbull-2" >
                                {{ totalComments }} <span class="glyphicon glyphicon-comment"></span>
                                <p>
                                    Nombre de commentaire
                                </p>
                            </button>
                        </a>
                        <button type="button" class="btn btn-list infosbull infosbull-2" data-toggle="modal" data-target="#signal">
                            <span class="glyphicon glyphicon-flag"></span>
                            <p>property
								Signaler
							</p>
                        </button>
                    </div>
                    <div id="share" class="collapse">
                        <div class="col-xs-12">
                            <div class="card pad-10">
                                <h2 class="card-title">Partager</h2>
                                <hr class="model_detail_hr">
                                <div class="card-body">
                                    Liens réseaux sociaux
                                </div>
                                <hr class="model_detail_hr">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 bg-white">
                        <div class="card">
                            <div class="col-xs-8 m-p-0">
                                <h2><p class="model_detail_title">{{ model.maker.company }}</p></h2>
                                <p>Inscrit depuis le {{ model.createdAt|date('d/m/Y', 'Europe/Paris') }}</p>
                            </div>
                            {% if logo is not null %}
                                <div class="col-xs-4 suggest-card">
                                    <div class="logo-card">
                                        <img class="logo-card img-circle" src="{{ logo }}" alt="logo de {{ model.maker.company }}">
                                    </div>
                                </div>
                            {% else %}
                                <div class="col-xs-4 suggest-card">
                                    <div class="logo-card">
                                        <img class="logo-card img-circle" src="{{ absolute_url(asset('assets/front/images/maker-avatar.png')) }}">
                                    </div>
                                </div>
                            {% endif %}
                            <div class="col-xs-12 m-p-0">
                                
                                <hr class="model_detail_hr m-p-0">
                                <div class="col-xs-6">
                                    <p align="center"><span class="glyphicon glyphicon-heart"></span>
                                        &nbsp;&nbsp;obtenu : {{ totalLove }}
                                    </p>
                                </div>
                                <div class="col-xs-6">
                                    <p align="center" ><span class="glyphicon glyphicon-download-alt"></span>&nbsp;&nbsp;obtenu : {{ totalDownload }}</p>
                                </div>
                                <a target="_blank" href="{{ path('model_find_by_maker', {'id': model.maker.id, 'company': model.maker.company}) }}">
                                    <p align="center">Autres modèles</p>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    {% if 0 < fiveSuggest|length %}
                    <div class="container bg-white pad-15-20 col-xs-12 suggest">
                        <div class="row">
                            <h2 class="card-title_suggestion">Suggestion(s)</h2>
                            <hr class="model_detail_hr">
                            {% for suggestion in fiveSuggest %}
                                <div class="suggest-card suggest">
                                    <div class="col-xs-5 suggest-card pad-15-20">
                                        <div class="item">
                                            <a target="_blank" href="{{ path('model_detail', {'id': suggestion.id, 'name': suggestion.name }) }}">
                                                <img class="pl-10 img-suggest" src="{{ suggestion.imageLink }}" alt="{{ suggestion.name }}" >
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-xs-7 card suggest pad-15-20">
                                        <a target="_blank" href="{{ path('model_detail', {'id': suggestion.id, 'name': suggestion.name}) }}">
                                            <p align="left" class="model_suggest">
                                                <u>
                                                    {{ suggestion.name|length > 19 ? suggestion.name|slice(0, 19) ~ '...': suggestion.name}}
                                                </u>
                                            </p>
                                        </a>
                                        <p class="model_suggest_maker">De : {{ suggestion.maker.company }}</p>
                                        <div class="col-xs-4">
                                            <p class="model_suggest_text" align="center">{{ suggestion.love}} <span class="glyphicon glyphicon-heart"></p>
                                        </div>
                                        <div class="col-xs-4">
                                            <p class="model_suggest_text" align="center">{{ suggestion.nbDownload}} <span class="glyphicon glyphicon-download-alt"></p>
                                        </div>
                                        <div class="col-xs-4">
                                            {% if suggestion.priceTaxIncl == 0 %}
                                                <p class="model_suggest_text" align="center">Gratuit</p>
                                            {% else %}
                                                <p class="model_suggest_text" align="center">{{ ((suggestion.priceTaxIncl)/100)|number_format(2, ',', '.') }} €</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div align="center" class="col-xs-12">
                                        <hr class="model_suggest_hr col-xs-12">
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-sm-6">
                <div class="col-xs-12">
                    <div class="col-xs-12">
                    <h1>
                    <p align="center" class="model_detail_title longtext">{{ model.name }}</p>
                    </h1>
                    </div>
                </div>
                    
                <hr class="model_detail_hr col-xs-12">
                <!--<h3>De : {{ model.maker.firstname }}</h3>-->
                <div class="col-sm-6 m-p-0">
                    <p>Publié le {{ model.createdAt|date('d/m/Y', 'Europe/Paris') }}<br />
                    Téléchargé {{ model.nbDownload }} fois</p>
                </div>
                <div class="col-sm-6">
                    {% if model.priceTaxIncl == 0 %}
                        <h3 class="model_detail_price" align="right">Gratuit</h3>
                    {% else %}
                        <h3 class="model_detail_price" align="right">{{ ((model.priceTaxIncl)/100)|number_format(2, ',', '.') }} € TTC</h3>
                        <p align="right">{{ ((model.priceTaxExcl)/100)|number_format(2, ',', '.') }} € HT</p>
                    {% endif %}
                </div>
                <div class="col-sm-12 cardlist-detail m-p-0">
                    <div class="card pad-10 mt-5 m-p-0" id="module">
                        <h2 class="card-title-long">Description</h2>
                        
                        <div class="card-body">
                            {% if ((model.description|nl2br|length - model.description|length) > 17) or (model.description|length > 250)  %}
                                <p class="collapse longtext text-detail" id="description" aria-expanded="false" >
                                    {{ model.description|nl2br }}
                                </p>
                                <div class="showMore" align="right">
                                    <a role="button" class="collapsed" data-toggle="collapse" href="#description" aria-expanded="false" aria-controls="collapseExample">
                                    </a>
                                </div>
                            {% else %}
                                <p class="longtext">{{ model.description|nl2br }}</p>
                            {% endif %}
                            
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 cardlist-detail m-p-0">
                    <div class="card pad-10 mt-5 m-p-0" id="module">
                        <h2 class="card-title-long">Caractéristique</h2>
                        <div class="card-body">
                            {% if  ((model.caracteristique|nl2br|length - model.caracteristique|length) > 17) or (model.caracteristique|length > 250)  %}
                                <p class="collapse longtext text-detail" id="caracteristique" aria-expanded="false">
                                    {{ model.caracteristique|nl2br }}
                                </p>
                                <div align="right">
                                    <a role="button" class="collapsed" data-toggle="collapse" href="#caracteristique" aria-expanded="false" aria-controls="collapseExample">
                                    </a>
                                </div>
                            {% else %}
                                <p class="longtext">{{ model.caracteristique|nl2br}}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 cardlist-detail m-p-0">
                    <div class="card pad-10 mt-5 m-p-0" id="module">
                        <h2 class="card-title-long">Licence</h2>
                        <div class="card-body">
                            <p class="longtext">{{ model.licences.name}}</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 cardlist m-p-0">
                    <div class="card pad-10 mt-5 m-p-0" id="moduleCategory">
                        <h2 class="card-title-long">Catégorie(s)</h2>
                        <div class="card-body">
                            {% if  categoryModel|length > 3  %}
                                <p class="collapse text-detail" id="category" aria-expanded="false">
                                    {% for category in categoryModel %}
                                            {{ category.upCategory.name}}
                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                            <a class="link" href="{{ path('model_find_by_category', { 'id': category.id , 'name': category.name })}}">{{ category.name}}</a><br>
                                    {% endfor %}  
                                </p>
                                <div align="right">
                                    <a role="button" class="collapsed" data-toggle="collapse" href="#category" aria-expanded="false" aria-controls="collapseExample">
                                    </a>
                                </div>
                            {% else %}
                                <p class="text-detail">
                                    {% for category in categoryModel %}
                                            {{ category.upCategory.name}}
                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                            <a target="_blank" class="link" href="{{ path('model_find_by_category', { 'id': category.id , 'name': category.name})}}">{{ category.name}}</a><br>
                                    {% endfor %}  
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 cardlist m-p-0" id="commentsAnchor">
                    <div class="card pad-10 mt-5 m-p-0">
                        <div class="col-xs-12 bg-white mt-5 mrg-b-40 pad-15-20">
                            <h2 class="card-title">Commentaire(s)</h2>
                            {% if user is defined %}
                                {% if user is null %}
                                    <div class="col-sm-12" align="right">
                                        <a class="btn btn-response" align="left" data-toggle="modal" data-target="#comment">Ajouter un commentaire</a>
                                    </div>
                                {% else %}
                                    <div class="col-sm-12" align="right">
                                        <button type="button" class="btn btn-response" data-toggle="collapse" data-target="#commentAdd">Ajouter un commentaire</button>
                                    </div>
                                {% endif %}
                            {% endif %}
                            
                            <div id="commentAdd" class="collapse">
                                <div class="card-body">
                                    {{ form_errors(form) }}
                                    {{ form_start(form) }}
                                    {{ form_widget(form.description) }}
                                    <p>
                                        Joindre image(s) au formats jpg ou png.
                                    </p>
                                    {{ form_widget(form.portfolioImages) }}
                                    {% if user is defined %}
                                        {% if user is null %}
                                            <div align="right">
                                                <a class="btn btn-response" align="left" data-toggle="modal" data-target="#comment">Enregistrer</a>
                                            </div>
                                        {% else %}
                                            <div align="right">
                                                {{ form_row(form.save) }}
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                    
                                    {{ form_end(form) }}
                                </div>
                            </div>
                            <div class="card-body" id="commentShow">
                                {% if  comments|length > 0  %}
                                    {% for comment in comments %}
                                    {% if  comment.upComments is null  %}
                                        <div class="col-xs-12 bg-white mt-5 pad-15-20">
                                            <div class="form-group">
                                                <div class="col-sm-12">
                                                    {% if comment.customer.maker == model.maker %}
                                                        <label class="control-label">{{ model.maker.company }}</label>
                                                    {% else %}
                                                        <label class="control-label">{{ comment.customer.firstname }}</label>
                                                    {% endif %}
                                                     - {{ comment.createdAt|date('d/m/Y', 'Europe/Paris') }}
                                                </div>
                                                <hr class="model_detail_hr col-xs-12">
                                                {% if  comment.portfolioImages|length > 0  %}
                                                    <div class="col-sm-12">
                                                    {% for image in comment.portfolioImages %}
                                                        <div class="col-xs-3 comment-card">
                                                            <div class="item">
                                                                <a href="{{ image.imageLink }}" target="_blank">
                                                                    <img class="pl-10 img-comment" src="{{ image.imageLink }}">
                                                                </a>
                                                            </div>
                                                        </div>
                                                    {% endfor %}  
                                                    </div>
                                                    <hr class="model_detail_hr col-xs-12">
                                                {% endif %}
                                                <div class="col-sm-1">
                                                </div>
                                                <div class="col-sm-11">
                                                    <p>
                                                        {{ comment.description }}
                                                    </p>
                                                </div>
                                                
                                                
                                                {% if user is defined %}
                                                    {% if user is null %}
                                                        <div class="col-sm-12" align="right">
                                                            <a class="btn btn-response" align="left" data-toggle="modal" data-target="#comment">Répondre</a>
                                                        </div>
                                                    {% else %}
                                                        <div class="col-sm-12" align="right">
                                                            <button type="button" class="btn btn-response" data-toggle="collapse" data-target="#comment-{{ comment.id }}">Répondre</button>
                                                        </div>
                                                    {% endif %}
                                                {% endif %}
                                                <div id="comment-{{ comment.id }}" class="collapse">
                                                    <hr class="model_detail_hr col-xs-12">
                                                    <div class="col-sm-6">
                                                        <h2 class="card-title">Ajouter une réponse</h2>
                                                    </div>
                                                    <div class="col-sm-6" align="right">
                                                        <a type="button" align="right" data-toggle="collapse" data-target="#comment-{{ comment.id }}"><span aria-hidden="true" class="glyphicon glyphicon-minus"></span></a>
                                                    </div>
                                                    <hr class="model_detail_hr col-xs-12">
                                                    <div class="card-body" id="responseComment-{{ loop.index }}">
                                                        <responseDiv>
                                                            {% set formIndex = formResponse.createView %}
                                                            {% form_theme formIndex 'form/modelComments.html.twig' %}
                                                            {{ form_errors(formIndex) }}
                                                            {{ form_start(formIndex) }}
                                                            {{ form_widget(formIndex.description) }}
                                                            <responseDivButton>
                                                                {% if user is defined %}
                                                                    {% if user is null %}
                                                                        <div align="right">
                                                                            <a class="btn btn-response" align="left" data-toggle="modal" data-target="#comment">Enregistrer</a>
                                                                        </div>
                                                                    {% else %}
                                                                        <div align="right">
                                                                            <button type="submit" class="btn btn-response" value="{{ comment.id }}" name="save" id="tea-submit">Enregistrer</button>
                                                                        </div>
                                                                    {% endif %}
                                                                {% endif %}
                                                                
                                                            </responseDivButton>
                                                            {{ form_end(formIndex) }}
                                                        </responseDiv>
                                                        
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    {% for commentResponse in comments %}
                                                        {% if  commentResponse.upComments == comment %}
                                                            <div class="col-xs-12 bg-white bg-white-response mt-5 pad-15-20">
                                                                <div class="form-group">
                                                                    <div class="col-sm-12">
                                                                        {% if commentResponse.customer.maker == model.maker %}
                                                                            <label class="control-label">{{ model.maker.company }}</label>
                                                                        {% else %}
                                                                            <label class="control-label">{{ commentResponse.customer.firstname }}</label>
                                                                        {% endif %}
                                                                         - {{ commentResponse.createdAt|date('d/m/Y', 'Europe/Paris') }}
                                                                    </div>
                                                                    <hr class="model_detail_hr col-xs-12">
                                                                    <div class="col-sm-1">
                                                                    </div>
                                                                    <div class="col-sm-11">
                                                                        <p>
                                                                            {{ commentResponse.description }}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}  
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% endfor %}  
                                {% endif %}
                                <commentNew>
                                </commentNew>
                            </div>
                            {% if totalComments > 3 %}
                                <div class="col-sm-12" align="center" id="btnMoreComment">
                                    <button type="button" class="btn btn-response" id="commentPlus">Afficher plus de commentaires</button>
                                </div>
                            {% endif %}
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="modal fade" id="myModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content bg-white">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Télécharger ce modèle</h4>
                        </div>
                        <div class="modal-body">
                            <p class="modal-text">Ce modèle est payant, vous devez être connecté pour l'ajouté à votre panier.</p>
                        </div>
                        <div class="modal-footer">
                            <table class='col-xs-12 cardlist'>
                                <thead>
                                    <th class='col-sm-6 text-center'>
                                        <form method="POST" action="{{ path('user_dashboard') }}">
                                            <button class="btn btn-rounded" type="submit" >Se connecter</button>
                                        </form>
                                    </th>
                                    <th class='col-sm-6 text-center'>
                                        <button type="button" class="btn" data-dismiss="modal">Fermer</button>
                                    </th>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="comment" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content bg-white">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Ajouter un commentaire</h4>
                        </div>
                        <div class="modal-body">
                            <p class="modal-text">Pour ajouter un commentaire, vous devez être connecté.</p>
                        </div>
                        <div class="modal-footer">
                            <table class='col-xs-12 cardlist'>
                                <thead>
                                    <th class='col-sm-6 text-center'>
                                        <form method="POST" action="{{ path('user_dashboard') }}">
                                            <button class="btn btn-rounded" type="submit" >Se connecter</button>
                                        </form>
                                    </th>
                                    <th class='col-sm-6 text-center'>
                                        <button type="button" class="btn" data-dismiss="modal">Fermer</button>
                                    </th>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="signal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content bg-white">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Signaler {{ model.name }}</h4>
                        </div>
                        {{ form_errors(signalForm) }}
                        {{ form_start(signalForm) }}
                        <div class="modal-body">
                            
                            {{ form_row(signalForm.signalRef) }}
                            {{ form_row(signalForm.description) }}
                            <p class="modal-text">Si vous voulez un retour à votre signalement, entrez votre adresse email</p>
                            {{ form_row(signalForm.email) }}
                            
                        </div>
                        <div class="modal-footer">
                            <table class='col-xs-12 cardlist'>
                                <thead>
                                    <th class='col-sm-6 text-center'>
                                        <button class="btn" type="submit" >Enregistrer</button>
                                    </th>
                                    <th class='col-sm-6 text-center'>
                                        <button type="button" class="btn" data-dismiss="modal">Fermer</button>
                                    </th>
                                </thead>
                            </table>
                        </div>
                        {{ form_end(signalForm) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('assets/front/js/jquery.collection.js') }}"></script>
    <script type="text/javascript">
        var commentPlus = 0;
        $(document).ready( function() {
            $('.portfolio-collection').collection({
                position_field_selector: '.image-position',
                min: 1,
                allow_duplicate: false,
                allow_up: false,
                allow_down: false,
                add:  '<a href="#" class="marginBtn"><span class="glyphicon glyphicon-plus"></span></a>',
                remove: '<a href="#" class="marginBtn"><span class="glyphicon glyphicon-trash"></span></a>'
            });
        });
        $("#addCart").click(function(e){
            $("#addCart").addClass("divBuy");
            //$("#addCart").addClass("allReady-Love");
            var currentLocation =  document.location.href;
            var data_list = currentLocation.split("/");
            console.log(data_list);
            

            $.ajax({
                url:'/fr/api/model/basket/add',
                type: "POST",
                dataType: "json",
                data: {
                    "model_id": data_list[6],
                },
                async: true,
                success: function (response)
                {
                    var len = response.length;
                    //console.log(len);
                    if(len > 0) {
                        for(var i=0; i<len; i++){

                            var data_json = JSON.stringify(response[i]); 
                            console.log(data_json);
                        }
                    }
                }
            })
            $("#dynamicBasket searchCategory").show();
            $("#dynamicBasket searchCategory").empty();
            $("#dynamicBasket searchCategory").append('Mon panier (...)');
            $.ajax({
                url:'/fr/api/model/basket',
                type: "POST",
                dataType: "json",
                data: {

                },
                async: true,
                success: function (response)
                {
                    //console.log('basket : ',response)
                    var len = response.data.length;
                    //console.log(len);
                    //$("#dynamicBasket searchCategory").empty();
                    if(len == 0){
                        //$("#dynamicBasket searchCategory").append('Mon panier');
                        $("#dynamicBasket searchCategory").hide();
                    } else {
                        $("#dynamicBasket searchCategory").show();
                        $("#dynamicBasket searchCategory").empty();
                        $("#dynamicBasket searchCategory").append('Mon panier (',len,')');
                    }
                }
            })
            $(document).ajaxError(function() {
                $("#dynamicBasket searchCategory").empty();
                $("#dynamicBasket searchCategory").hide();
                //$("#dynamicBasket searchCategory").append('Mon panier');
            });
        });

        function sleep(seconds){
            var waitUntil = new Date().getTime() + seconds*1000;
            while(new Date().getTime() < waitUntil) true;
        }

        async function addSubmitButton(listIdComments, userConnect){
            var len = listIdComments.length;
            if(userConnect == true) {
                for(var i=0; i<10; i++) {
                    var submitButton = 
                        "<div align='right'>" +
                            "<button type='submit' class='btn btn-response' value='"+listIdComments[i]+"' name='save' id='tea-submit'>Enregistrer</button>" +
                        "</div>";
                    let idButton = "commentBody-"+listIdComments[i]+" responsedivbutton";
                    await $("#" + idButton).empty();
                    await $("#" + idButton).append(submitButton);
                }
            } else {
                for(var i=0; i<10; i++) {
                    var submitButton = 
                        "<div align='right'>" +
                            "<a class='btn btn-response' align='left' data-toggle='modal' data-target='#comment'>Enregistrer</a>" +
                        "</div>";
                    let idButton = "commentBody-"+listIdComments[i]+" responsedivbutton";
                    await $("#" + idButton).empty();
                    await $("#" + idButton).append(submitButton);
                }
            }
            
        }
        
        var NewSubmitButton = [];
        async function f1(id, oneMoreComment) {
            
            $("commentNew").append(oneMoreComment);

            $("newResponse").empty();
            $("#responseComment-1 responseDiv").clone().appendTo("newResponse");
            
            var submitButton = 
                "<div align='right'>" +
                    "<button type='submit' class='btn btn-response' value='"+id+"' name='save' id='tea-submit'>EnregistrerFin</button>" +
                "</div>";
            let buttonDelete = id.toString();
            let idButton = "commentBody-"+buttonDelete+" form";
            await $("#" + idButton).empty();
            //await $("responseDivButton").last().empty();
            await $("#" + idButton).append(submitButton);
            //await $("responseDivButton").last().append(submitButton);
            console.log('before');
            //sleep(2);
            //window.setTimeout(sleep(0.5), 0);
            console.log('after');
        };

        $("#commentPlus").click(function(e){
            var currentLocation =  document.location.href;
            var data_list = currentLocation.split("/");
            //console.log(data_list[6]);

            $("#btnMoreComment").hide();      // Hide
            //console.log('aPlus' + data_list[6]);
            
            $.ajax({
                url:'/fr/api/model/comment',
                type: "POST",
                dataType: "json",
                data: {
                    "model_id": data_list[6],
                },
                async: true,
                success: function (response)
                {
                    NewSubmitButton = []
                    var commentslice = 10*commentPlus;
                    commentPlus = commentPlus + 1;
                    var nbTotalComment = response.data.length;
                    //console.log(nbTotalComment);
                    console.log(response.data.slice(commentslice+3, commentslice+13));
                    var newCommentShow = response.data.slice(commentslice+3, commentslice+13);
                    //console.log(newCommentShow[0].customer);
                    //var form = $("responseDiv").clone();
                    var nbOfNewComment = 10;
                    if(commentslice+13 > nbTotalComment) {
                        nbOfNewComment = 10 - (commentslice+13 - nbTotalComment);
                    }
                    console.log(nbOfNewComment);

                    for(var i=0; i<nbOfNewComment; i++){
                        //console.log(newCommentShow[i].response.length)
                        var tr_str = 
                            "<div class='col-xs-12 bg-white mt-5 pad-15-20'>" +
                                "<div class='form-group'>" + // cadre blanc autour de la carte : pad-10 mt-5
                                    "<div class='col-sm-12'>" + 
                                        "<label class='control-label'>"+ newCommentShow[i].customer+ "</label>" + 
                                        " - " + newCommentShow[i].createdAt +
                                    "</div>";
                                    
                                            
                        var imagesComment = "";
                        var nbOfImg = newCommentShow[i].images.length;
                        if(nbOfImg > 0) {
                            imagesComment = "<hr class='model_detail_hr col-xs-12'>" +
                                "<div class='col-sm-12'>";
                            for(var k=0; k<nbOfImg; k++){
                                imagesComment +=
                                    "<div class='col-xs-3 comment-card'>" + 
                                        "<div class='item'>" +
                                            "<a href='"+newCommentShow[i].images[k].linkImage+"' target='_blank'>" +
                                                "<img class='pl-10 img-comment' src='"+newCommentShow[i].images[k].linkImage+"'>" +
                                            "</a>" +
                                        "</div>" +
                                    "</div>";
                            }
                            imagesComment = imagesComment + "</div>";
                        }
                        
                        tr_str += imagesComment + 
                                    "</div>" +
                                    "<hr class='model_detail_hr col-xs-12'>" +
                                    "<div class='col-sm-1'>" + 
                                    "</div>" +
                                    "<div class='col-sm-11'>" + 
                                        "<p>" + newCommentShow[i].description +"</p>" +
                                    "</div>" +
                                    "<div class='col-sm-12' align='right'>" + 
                                        "<button type='button' class='btn btn-response' data-toggle='collapse' data-target='#comment-" + newCommentShow[i].id +"'>" +
                                        "Répondre </button>" +
                                    "</div>" +
                                    "<div id='comment-"+newCommentShow[i].id+"' class='collapse'>" +
                                        "<hr class='model_detail_hr col-xs-12'>" +
                                        "<div class='col-sm-6'>" +
                                            "<h2 class='card-title'>Ajouter une réponse</h2>" +
                                        "</div>" +
                                        "<div class='col-sm-6' align='right'>" +
                                            "<a type='button' data-toggle='collapse' data-target='#comment-" + newCommentShow[i].id +"'><span aria-hidden='true' class='glyphicon glyphicon-minus'></span></a>" +
                                        "</div>" +
                                        "<hr class='model_detail_hr col-xs-12'>" +
                                        "<div class='card-body' id='commentBody-"+newCommentShow[i].id+"'>" +
                                                "<newResponse id='responseCommentForm'>" +
                                                "</newResponse>" +
                                        "</div>" +
                                    "</div>";
                                

                        var responses = "<div class='card-body'>";
                        var nbOfResponse = newCommentShow[i].response.length;
                        for(var j=0; j<nbOfResponse; j++){
                            responses +=
                                "<div class='col-xs-12 bg-white bg-white-response mt-5 pad-15-20'>" +
                                    "<div class='form-group'>" +
                                        "<div class='col-sm-12'>" +
                                            "<label class='control-label'>"+ newCommentShow[i].response[j].customer+ "</label>" + 
                                            " - " + newCommentShow[i].response[j].createdAt +
                                        "</div>" +
                                        "<hr class='model_detail_hr col-xs-12'>" +
                                        "<div class='col-sm-1'>" + 
                                        "</div>" +
                                        "<div class='col-sm-11'>" + 
                                            "<p>" + newCommentShow[i].response[j].description +"</p>" +
                                        "</div>" +
                                    "</div>" +
                                "</div>";
                        }
                        //console.log(responses);
                        responses = responses + "</div>";
                        tr_str += responses + "</div>" + "</div>";
                        
                        $("commentNew").append(tr_str);
                        
                        $("newResponse").empty();
                        $("#responseComment-1 responseDiv").clone().appendTo("newResponse");
                        NewSubmitButton.push(newCommentShow[i].id);

                        var userConnect = newCommentShow[i].user;
                    }

                    //console.log(NewSubmitButton);
                    
                    addSubmitButton(NewSubmitButton, userConnect);

                    console.log(nbTotalComment);

                    if(commentslice+13 < nbTotalComment) {
                        $("#btnMoreComment").show(); 
                    }
                    
                    
                    
                    
                    
                }
            })
            
        });
        
    </script>
{% endblock %}
