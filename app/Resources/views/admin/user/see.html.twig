{% extends 'admin/layout.html.twig' %}

{% set activeTab = 'user' %}
{% set activeMenu = 'user_list' %}

{% block body %}
    <div class="row">
        <div class="col-sm-9">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-sm-6">
                            {{ user.lastname|upper }}{% if user.firstname is not null %} {{ user.firstname }}{% endif %}
                            <br>{% if user.type is same as(constant('\\AppBundle\\Entity\\User::TYPE_INDIVIDUAL')) %}Particulier{% else %}Entreprise : {{ user.company|upper }}{% if user.companyType is not null %} ({{ user.companyType }}){% endif %}{% endif %}
                            
                            <span class="panel-subtitle">{{ 'admin.user.see.created_at'|trans }} {{ user.createdAt|date('d/m/Y H:i', app.user.timezone) }}</span>
                            <span class="panel-subtitle">{% if user.enabled %}{{ 'admin.user.see.enabled_at'|trans }} {{ user.enabledAt|date('d/m/Y H:i', app.user.timezone) }}{% elseif user.isDeleted()%} {{ 'admin.user.see.deleted_at'|trans }} {{ user.updatedat|date('d/m/Y H:i', app.user.timezone) }} {% else %} {{ 'admin.user.see.not_enabled'|trans }}   {% endif %}</span>
                        
                           {% if user.isControlAdmin () %}
                                <a  class="panel-subtitle" href="{{ path('admin_user_controle', {'id': user.id ,'getControle': 0}) }}">Liberer le controle par l'admin</a>
                            {% else  %}
                                <a  class="panel-subtitle" href="{{ path('admin_user_controle', {'id': user.id ,'getControle': 1}) }}">Prendre le controle du compte</a>
                            {% endif %}
                            {% if user.isDeleted () == false  %}
                                <a  class="panel-subtitle" href="{{ path('admin_user_delete', {'id': user.id }) }}">Supprimer le compte</a>
                            {% endif %}
                         
                        </div>
                        <div class="col-sm-6 text-right">
                            {% if user.maker is not null %}
                                {{ 'admin.user.type.maker'|trans }}
                                <span class="panel-subtitle">
                                    {% if user.maker.printer %}
                                        {{ 'admin.user.type.maker.printer'|trans }}
                                    {% endif %}
                                    {% if user.maker.designer %}
                                        {{ 'admin.user.type.maker.designer'|trans }}
                                    {% endif %}
                                </span>
                                <span class="panel-subtitle"><a href="{{ path('admin_maker_see', { 'id': user.maker.id }) }}">{{ 'admin.user.see.see_maker'|trans }}</a></span>
                            {% else %}
                                {{ 'admin.user.type.customer'|trans }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading panel-heading-divider">
                            Adresse de livraison par défaut
                        </div>
                        <div class="panel-body">
                            {% if user.defaultShippingAddress is not null %}{% include 'front/common/address.html.twig' with { address: user.defaultShippingAddress } %}{% else %}n/a{% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading panel-heading-divider">
                            Adresse de facturation par défaut
                        </div>
                        <div class="panel-body">
                            {% if user.defaultBillingAddress is not null %}{% include 'front/common/address.html.twig' with { address: user.defaultBillingAddress } %}{% else %}n/a{% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading panel-heading-divider">
                    <div class="row">
                        <div class="col-sm-12">
                            Commandes
                            <span class="panel-subtitle">{{ user.orders|length }} commandes</span>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <table id="table-user-order-list" class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>{{ 'admin.order.list.column.id'|trans }}</th>
                            <th>{{ 'admin.order.list.column.date'|trans }}</th>
                            <th>{{ 'admin.order.list.column.reference'|trans }}</th>
                            <th>{{ 'admin.order.list.column.status'|trans }}</th>
                            <th>{{ 'admin.order.list.column.maker'|trans }}</th>
                            <th>{{ 'admin.order.list.column.amount'|trans }}</th>
                            <th class="actions"></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for order in user.orders %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td data-order="{{ order.createdAt|date('YmdHis') }}">{{ order.createdAt|date('d/m/Y H:i', app.user.timezone) }}</td>
                                <td><a href="{{ path('admin_order_see', { 'reference': order.reference }) }}">{{ order.reference }}</a></td>
                                <td data-order="{{ order.status }}">{{ order.adminReadableStatus }}</td>
                                <td>{{ order.maker.fullname }}</td>
                                <td data-order="{{ order.totalAmountTaxIncl }}">{{ (order.totalAmountTaxIncl / 100)|number_format(2) }} € TTC</td>
                                <td class="actions"><a href="{{ path('admin_order_see', { 'reference': order.reference }) }}" class="icon"><i class="s7-right-arrow"></i></a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading panel-heading-divider">
                    <div class="row">
                        <div class="col-sm-12">
                            Projets Design
                            <span class="panel-subtitle">{{ user.projects|length }} projets</span>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <table id="table-user-project-list" class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>{{ 'admin.project.list.column.id'|trans }}</th>
                            <th>{{ 'admin.project.list.column.reference'|trans }}</th>
                            <th>{{ 'admin.project.list.column.date'|trans }}</th>
                            <th>{{ 'admin.project.list.column.status'|trans }}</th>
                            <th>{{ 'admin.project.list.column.nb.maker'|trans }}</th>
                            <th>{{ 'admin.project.list.column.nb.quotation'|trans }}</th>
                            <th>{{ 'admin.project.list.column.waiting.moderate'|trans }}</th>
                            <th>{{ 'admin.project.list.column.closedat'|trans }}</th>
                            <th class="actions"></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for project in user.projects %}
                            <tr>
                                <td>{{ project.id }}</td>
                                <td><a href="{{ path('admin_project_see', { 'reference': project.reference }) }}">{{ project.reference }}</a></td>
                                <td data-order="{{ project.createdAt|date('YmdHis') }}">{{ project.createdAt|date('d/m/Y H:i', app.user.timezone) }}</td>
                                <td data-order="{{ project.status }}">{{ project.adminReadableStatus }}</td>
                                <td data-order="{{ project.quotations|length}}">{{ project.quotations|length}}</td>
                                <td data-order="{{ project.nbQuotationForCustomer }}">{{ project.nbQuotationForCustomer }}</td>
                                <td data-order="{{project.nbModerationWaiting}}">{{ project.nbModerationWaiting }}</td>
                                <td data-order="{{ project.remainingDay }}">
                                    {% if project.remainingDay < 0 %}
                                        Terminé
                                    {% else %}
                                        J -{{ project.remainingDay }}
                                    {% endif %}
                                </td>
                                <td class="actions"><a href="{{ path('admin_project_see', { 'reference': project.reference }) }}" class="icon"><i class="s7-right-arrow"></i></a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="panel panel-default">
                <div class="panel-heading panel-heading-divider">
                    {{ 'admin.user.see.contact'|trans }}
                </div>
                <div class="panel-body">
                    <p><span class="icon s7-mail"></span> <a href="mailto:{{ user.email }}">{{ user.email }}</a></p>
                    <p><span class="icon s7-phone"></span> {% if user.defaultBillingAddress is not null and user.defaultBillingAddress.telephone is not null %}{{ user.defaultBillingAddress.telephone }}{% else %}{{ 'admin.empty'|trans }}{% endif %}</p>
                    <p><span class="icon s7-paper-plane"></span> {% if user.newsletter %}{{ 'admin.user.see.newsletter.yes'|trans }}{% else %}{{ 'admin.user.see.newsletter.no'|trans }}{% endif %}</p>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading panel-heading-divider">
                    Paiement SEPA
                </div>
                <div class="panel-body">
                    {{ form_start(sepaForm) }}
                    {{ form_row(sepaForm.sepa) }}
                    {{ form_row(sepaForm.sepaNotes) }}
                    <button type="submit" id="form_submit" name="form[submit]" class="btn btn-space btn-primary"><i class="s7-diskette"></i> {{ 'form.save'|trans }}</button>
                    {{ form_end(sepaForm) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}